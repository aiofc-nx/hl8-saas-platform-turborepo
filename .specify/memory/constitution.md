<!--
==============================================================================
SYNC IMPACT REPORT
==============================================================================
Version Change: 初始版本 → 1.0.0
Rationale: 首次制定项目宪章，确立核心原则和治理规范

Modified Principles:
- NEW: I. 中文优先原则 (NON-NEGOTIABLE)
- NEW: II. 代码即文档原则
- NEW: III. 架构原则
- NEW: IV. Monorepo组织原则
- NEW: V. 质量保证原则

Added Sections:
- 核心原则
- 技术约束
- 开发工作流
- 治理规范

Templates Requiring Updates:
✅ plan-template.md - Constitution Check 部分已对齐核心原则
✅ spec-template.md - 用户场景和需求与代码即文档原则对齐
✅ tasks-template.md - 任务组织与架构原则对齐

Follow-up TODOs:
- 无待办事项

Date: 2025-10-10
==============================================================================
-->

# HL8 SAAS Platform Constitution

## 核心原则

### I. 中文优先原则 (NON-NEGOTIABLE)

**所有代码注释、文档、错误消息和用户界面必须使用中文。**

这是项目的非协商性要求，确保中国开发团队的理解和协作效率。

- 代码注释必须使用中文，遵循 TSDoc 规范
- 技术文档必须使用中文编写
- 用户界面文本必须使用中文
- 错误消息和日志必须使用中文
- API 文档和接口说明必须使用中文
- Git 提交消息推荐使用中文
- 代码变量命名使用英文，但必须有中文注释说明

**理由**：本项目面向中国大陆地区的企业级SAAS平台，中文优先确保团队沟通效率、代码可维护性和业务理解的一致性。

### II. 代码即文档原则

**代码注释必须清晰、准确、完整地描述业务规则与逻辑。**

- 遵循 TSDoc 注释规范
- 所有公共 API、类、方法、接口、枚举都必须添加完整的 TSDoc 注释
- 注释必须包含：
  - `@description`: 功能描述和业务逻辑
  - `@param`: 参数说明（含业务含义）
  - `@returns`: 返回值说明
  - `@throws`: 异常情况说明
  - `@example`: 使用示例
  - 业务规则详细描述
  - 前置条件和后置条件
  - 使用场景和注意事项
- 代码变更时必须同步更新注释
- 详细规范见 `.cursor/constitutions/code-comment-standards.md`

**理由**：通过详细的注释让代码本身成为最好的业务文档，减少文档维护成本，提高团队协作效率，确保业务逻辑的准确传承。

### III. 架构原则

**项目采用混合架构模式：Clean Architecture + CQRS + 事件溯源 (ES) + 事件驱动架构 (EDA)**

- **Clean Architecture**：
  - 领域实体和聚合根必须分离
  - 用例（Use Cases）必须在文档和设计中明确提及
  - 依赖关系从外向内，内层不依赖外层
  - 核心业务逻辑独立于框架和基础设施
  
- **CQRS 模式**：
  - 命令（Command）和查询（Query）必须分离
  - 写操作使用命令模型
  - 读操作使用查询模型
  - 支持独立优化和扩展
  
- **事件溯源 (ES)**：
  - 所有状态变更通过事件记录
  - 事件是不可变的事实记录
  - 支持状态重建和审计追踪
  
- **事件驱动架构 (EDA)**：
  - 系统组件通过事件通信
  - 支持异步处理和解耦
  - 确保最终一致性

**理由**：混合架构模式为企业级SAAS平台提供高可扩展性、高性能、高可靠性和高可维护性，适应复杂的业务场景和未来微服务部署需求。

### IV. Monorepo 组织原则

**使用 Turborepo 管理多个相关项目，实现代码共享和独立部署**

- **项目结构**：
  - `apps/`: 应用程序项目
  - `packages/`: 业务库、领域模块、共享库和工具包
  - `examples/`: 示例和演示项目
  
- **领域模块独立性**：
  - 领域模块作为独立项目开发
  - 便于未来微服务部署
  - 模块间通过明确的接口通信
  
- **服务模块命名**：
  - 服务模块放在 services 目录时，去掉 "-service" 后缀
  - 例如：`auth-service` → `auth`
  
- **包管理**：
  - 必须使用 pnpm 作为包管理工具
  - 通过 `pnpm-workspace.yaml` 管理项目依赖
  - 使用 `turbo run` 执行项目任务

**理由**：Monorepo 结构支持代码复用、统一配置管理和原子化提交，同时保持各模块的独立性，为微服务架构演进奠定基础。

### V. 质量保证原则

**确保代码质量、可维护性和可测试性**

- **ESLint 规范**：
  - 项目使用 `eslint.config.mjs` 作为配置文件
  - 子项目必须扩展并集成根目录的 ESLint 配置
  - 主动使用 MCP ESLint 工具进行代码检查和自动修复
  
- **TypeScript 配置**：
  - 每个 `libs/<package>/tsconfig.json` 必须扩展 monorepo 根 tsconfig.json
  - 确保配置一致性
  
- **测试策略**：
  - 单元测试文件（.spec.ts）与被测试文件放在同级目录
  - 测试覆盖核心业务逻辑
  - 支持集成测试和端到端测试
  
- **文档规范**：
  - 详细设计文件使用 "XS" 前缀而非 "详细设计"
  - 保持文档与代码同步更新

**理由**：统一的质量标准和工具链确保代码库的长期可维护性，减少技术债务，提高团队协作效率。

## 技术约束

### 技术栈要求

**运行环境和开发工具：**

- **运行环境**：Node.js >= 18
- **开发语言**：TypeScript 5.9.2
- **包管理器**：pnpm 9.0.0
- **构建工具**：Turborepo 2.5.8
- **代码格式化**：Prettier 3.6.2
- **后端框架**：NestJS（推荐）
- **架构模式**：Clean Architecture + CQRS + ES + EDA

### 配置管理

**配置文件位置和继承规则：**

- **配置文件位置**：
  - 根目录：全局配置（ESLint、TypeScript、Prettier、Turborepo）
  - 子项目：扩展并定制根配置
  
- **配置继承原则**：
  - 子项目配置必须继承根配置
  - 仅在必要时添加项目特定配置
  - 避免配置碎片化

### 性能和可扩展性

**系统设计要求：**

- **水平扩展**：系统设计必须支持水平扩展
- **缓存策略**：合理使用缓存提升性能
- **数据库**：支持读写分离和分库分表
- **消息队列**：使用消息队列实现异步处理和解耦

## 开发工作流

### 工作目录规范

- **命令执行位置**：
  - 所有命令必须在 monorepo 根路径执行：`/home/arligle/hl8/hl8-saas-platform-turborepo`
  - 使用相对路径或绝对路径进入子项目目录
  - 示例：`cd /home/arligle/hl8/hl8-saas-platform-turborepo && cd packages/auth && pnpm build`
  
- **避免直接切换**：
  - 不要直接切换到子项目目录
  - 确保命令执行的上下文正确性

### MCP 工具优先

- **主动使用 MCP 工具**：
  - 优先使用可用的 MCP 工具处理任务
  - MCP 工具比手动操作更准确、更高效
  
- **可用工具**：
  - `eslint_lint_files`: 检查代码质量和规范
  - `eslint_fix_files`: 自动修复代码问题
  - Nx MCP 工具：项目管理和文档查询

### 代码变更流程

1. **需求分析**：明确业务需求和技术方案
2. **架构设计**：遵循 Clean Architecture + CQRS + ES + EDA
3. **接口定义**：设计清晰的模块接口
4. **实现开发**：编写符合规范的代码和注释
5. **质量检查**：运行 ESLint、TypeScript 检查
6. **测试验证**：执行单元测试和集成测试
7. **代码审查**：团队成员审查代码和注释
8. **文档更新**：同步更新相关文档

### 代码审查要求

- **注释审查**：
  - 验证 TSDoc 注释完整性
  - 检查业务规则描述准确性
  - 确认中文注释清晰度
  
- **架构审查**：
  - 验证是否符合架构原则
  - 检查依赖方向是否正确
  - 确认模块边界清晰
  
- **质量审查**：
  - 运行 ESLint 检查
  - 验证类型安全
  - 检查测试覆盖率

## 治理规范

### 宪章效力

- 本宪章优先于所有其他实践和规范
- 所有 PR 和代码审查必须验证是否符合宪章要求
- 任何复杂性必须有充分理由并在文档中说明

### 修订流程

1. **提议修订**：团队成员提出修订建议，说明理由和影响
2. **影响评估**：评估修订对现有代码和流程的影响
3. **团队讨论**：团队讨论修订的必要性和合理性
4. **批准决策**：技术负责人批准修订
5. **版本更新**：按语义化版本规则更新版本号
6. **文档同步**：更新所有相关文档和模板
7. **团队通知**：通知团队成员修订内容

### 版本控制

**版本格式**：MAJOR.MINOR.PATCH

- **MAJOR（主版本）**：不向后兼容的治理/原则移除或重新定义
- **MINOR（次版本）**：新增原则/章节或重要扩展
- **PATCH（修订版）**：澄清说明、措辞优化、错误修复

### 合规性审查

- **定期审查**：每季度审查宪章执行情况
- **违规处理**：记录违规情况，分析原因，制定改进措施
- **持续改进**：根据实践反馈优化宪章内容

### 运行时指导

- 开发过程中参考 `.cursor/rules/pre-rule.mdc` 获取运行时开发指导
- 使用 `.cursor/constitutions/code-comment-standards.md` 作为注释规范详细指南

---

**版本**: 1.0.0 | **批准日期**: 2025-10-10 | **最后修订**: 2025-10-10
