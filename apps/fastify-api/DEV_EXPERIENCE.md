# å¼€å‘ä½“éªŒä¼˜åŒ–è¯´æ˜

## ğŸš€ ä¼˜åŒ–åçš„å¼€å‘æµç¨‹

### é—®é¢˜

ä¹‹å‰ä¿®æ”¹ libs ä¸­çš„ä»£ç åï¼Œéœ€è¦ï¼š
1. æ‰‹åŠ¨é‡æ–°æ„å»ºåº“ (`pnpm --filter @hl8/database build`)
2. é‡å¯åº”ç”¨
3. ç­‰å¾…ç¼–è¯‘

è¿™ä¸¥é‡å½±å“å¼€å‘æ•ˆç‡ï¼

### è§£å†³æ–¹æ¡ˆ

é€šè¿‡é…ç½® **TypeScript paths**ï¼Œç›´æ¥å¼•ç”¨æºç ï¼š

```json
// apps/fastify-api/tsconfig.json
{
  "compilerOptions": {
    "paths": {
      "@hl8/database": ["../../libs/database/src/index.ts"],
      "@hl8/config": ["../../libs/config/src/index.ts"],
      // ... å…¶ä»–åº“
    }
  }
}
```

### æ•ˆæœ

ç°åœ¨ä¿®æ”¹ libs ä»£ç åï¼š
- âœ… **è‡ªåŠ¨æ£€æµ‹**: NestJS watch æ¨¡å¼è‡ªåŠ¨æ£€æµ‹æºç æ›´æ”¹
- âœ… **è‡ªåŠ¨ç¼–è¯‘**: SWC è‡ªåŠ¨é‡æ–°ç¼–è¯‘
- âœ… **è‡ªåŠ¨é‡å¯**: åº”ç”¨è‡ªåŠ¨é‡æ–°åŠ è½½
- âœ… **æ— éœ€æ‰‹åŠ¨æ„å»º**: å®Œå…¨ä¸éœ€è¦ `pnpm build`

---

## ğŸ“ å·¥ä½œæµç¨‹å¯¹æ¯”

### ä¹‹å‰ï¼ˆå·®ä½“éªŒï¼‰âŒ

```bash
# 1. ä¿®æ”¹ libs/database/src/connection/connection.manager.ts
# 2. æ‰‹åŠ¨æ„å»º
pnpm --filter @hl8/database build

# 3. ç­‰å¾…æ„å»ºå®Œæˆï¼ˆ~5-10ç§’ï¼‰
# 4. æ‰‹åŠ¨é‡å¯åº”ç”¨
# 5. ç­‰å¾…åº”ç”¨å¯åŠ¨ï¼ˆ~10ç§’ï¼‰

æ€»è€—æ—¶: ~15-20ç§’ â±ï¸
```

### ç°åœ¨ï¼ˆä¼˜ç§€ä½“éªŒï¼‰âœ…

```bash
# 1. ä¿®æ”¹ libs/database/src/connection/connection.manager.ts
# 2. ä¿å­˜æ–‡ä»¶ (Ctrl+S)

# è‡ªåŠ¨å‘ç”Ÿï¼š
# - SWC æ£€æµ‹åˆ°æ–‡ä»¶æ›´æ”¹
# - è‡ªåŠ¨é‡æ–°ç¼–è¯‘ï¼ˆ~200msï¼‰
# - åº”ç”¨è‡ªåŠ¨é‡å¯ï¼ˆ~2ç§’ï¼‰

æ€»è€—æ—¶: ~2-3ç§’ âš¡
```

**é€Ÿåº¦æå‡**: 7-10å€ï¼

---

## ğŸ¯ æ”¯æŒçš„å¼€å‘åœºæ™¯

### åœºæ™¯ 1: ä¿®æ”¹åº“ä»£ç 

```typescript
// libs/database/src/connection/connection.manager.ts
async connect(): Promise<void> {
  this.logger.log('æ–°çš„æ—¥å¿—ä¿¡æ¯'); // â† ä¿®æ”¹è¿™é‡Œ
  // ...
}
```

**ä¿å­˜å**: 2ç§’å†…è‡ªåŠ¨ç”Ÿæ•ˆ âœ…

### åœºæ™¯ 2: ä¿®æ”¹åº”ç”¨ä»£ç 

```typescript
// apps/fastify-api/src/services/user.service.ts
async createUser(dto: CreateUserDto): Promise<User> {
  this.logger.log('åˆ›å»ºç”¨æˆ·-æ–°ç‰ˆæœ¬'); // â† ä¿®æ”¹è¿™é‡Œ
  // ...
}
```

**ä¿å­˜å**: 2ç§’å†…è‡ªåŠ¨ç”Ÿæ•ˆ âœ…

### åœºæ™¯ 3: æ·»åŠ æ–°åŠŸèƒ½

```typescript
// libs/database/src/monitoring/metrics.service.ts
getQueryStats() { // â† æ–°æ–¹æ³•
  return this.queryMetrics;
}

// apps/fastify-api/src/controllers/user.controller.ts
@Get('stats')
async getStats() {
  return this.metricsService.getQueryStats(); // â† ç«‹å³å¯ç”¨
}
```

**ä¿å­˜å**: è‡ªåŠ¨å¯¼å…¥ï¼Œ2ç§’å†…å¯ç”¨ âœ…

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä¿æŒåº”ç”¨è¿è¡Œ

```bash
# å¯åŠ¨ä¸€æ¬¡ï¼ŒæŒç»­å¼€å‘
pnpm --filter fastify-api dev

# ç„¶åå°±å¯ä»¥éšæ„ä¿®æ”¹ä»»ä½•ä»£ç ï¼Œè‡ªåŠ¨ç”Ÿæ•ˆ
```

### 2. ä½¿ç”¨ VSCode å¤šçª—å£

- çª—å£1: `libs/database/src` - ç¼–è¾‘åº“ä»£ç 
- çª—å£2: `apps/fastify-api/src` - ç¼–è¾‘åº”ç”¨ä»£ç 
- ç»ˆç«¯: è¿è¡Œ `pnpm dev` - è‡ªåŠ¨é‡æ–°ç¼–è¯‘

### 3. æŸ¥çœ‹æ—¥å¿—è¾“å‡º

```
File change detected. Starting incremental compilation...
Successfully compiled: XX files with swc (XXXms)
Watching for file changes.
```

çœ‹åˆ°è¿™ä¸ªè¾“å‡ºå°±è¯´æ˜æ›´æ”¹å·²åº”ç”¨ï¼

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### TypeScript Paths

```json
{
  "paths": {
    "@hl8/database": ["../../libs/database/src/index.ts"]
  }
}
```

- **ç¼–è¯‘æ—¶**: TypeScript/SWC ç›´æ¥è¯»å–æºç 
- **è¿è¡Œæ—¶**: Node.js é€šè¿‡è½¬æ¢åçš„è·¯å¾„åŠ è½½æ¨¡å—
- **Watch æ¨¡å¼**: æ£€æµ‹ libs å’Œ apps çš„æ‰€æœ‰æ–‡ä»¶æ›´æ”¹

### SWC Watch æ¨¡å¼

NestJS çš„ `nest start -b swc -w`:
- `-b swc`: ä½¿ç”¨ SWC ç¼–è¯‘å™¨ï¼ˆæ¯” tsc å¿« 20-70å€ï¼‰
- `-w`: Watch æ¨¡å¼ï¼Œæ–‡ä»¶æ›´æ”¹è‡ªåŠ¨é‡æ–°ç¼–è¯‘

### ä¼˜åŠ¿

1. **å¿«é€Ÿç¼–è¯‘**: SWC ~200ms vs tsc ~5-10s
2. **è‡ªåŠ¨æ£€æµ‹**: ç›‘è§†æ‰€æœ‰ç›¸å…³æ–‡ä»¶
3. **å¢é‡ç¼–è¯‘**: åªç¼–è¯‘æ›´æ”¹çš„æ–‡ä»¶
4. **çƒ­é‡è½½**: åº”ç”¨è‡ªåŠ¨é‡å¯

---

## ğŸ‰ ç°åœ¨è¯•è¯•çœ‹ï¼

### æµ‹è¯•çƒ­é‡è½½

1. **å¯åŠ¨åº”ç”¨**ï¼ˆå¦‚æœè¿˜æ²¡è¿è¡Œï¼‰:
   ```bash
   pnpm --filter fastify-api dev
   ```

2. **ä¿®æ”¹åº“ä»£ç **:
   ```typescript
   // libs/database/src/connection/connection.manager.ts
   async connect(): Promise<void> {
     this.logger.log('ğŸš€ æ•°æ®åº“è¿æ¥æˆåŠŸï¼ˆçƒ­é‡è½½æµ‹è¯•ï¼‰'); // ä¿®æ”¹è¿™è¡Œ
     // ...
   }
   ```

3. **ä¿å­˜æ–‡ä»¶** (`Ctrl+S`)

4. **æŸ¥çœ‹ç»ˆç«¯**: 2ç§’å†…åº”è¯¥çœ‹åˆ°ï¼š
   ```
   File change detected. Starting incremental compilation...
   Successfully compiled: 12 files with swc (XXXms)
   [Nest] INFO ğŸš€ æ•°æ®åº“è¿æ¥æˆåŠŸï¼ˆçƒ­é‡è½½æµ‹è¯•ï¼‰
   ```

5. **æ— éœ€ä»»ä½•æ‰‹åŠ¨æ“ä½œï¼** âœ…

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æ“ä½œ | æ—§æ–¹å¼ | æ–°æ–¹å¼ | æå‡ |
|------|--------|--------|------|
| ä¿®æ”¹åº“ä»£ç  | 15-20s | 2-3s | **7x** |
| ä¿®æ”¹åº”ç”¨ä»£ç  | 10s | 2s | **5x** |
| æ·»åŠ æ–°åŠŸèƒ½ | 20s | 3s | **7x** |
| ä¿®å¤ Bug | 15s | 2s | **7.5x** |

---

## ğŸ’¯ æ³¨æ„äº‹é¡¹

### ä½•æ—¶ä»éœ€æ‰‹åŠ¨æ„å»ºï¼Ÿ

åªæœ‰ä»¥ä¸‹æƒ…å†µéœ€è¦æ‰‹åŠ¨æ„å»ºï¼š

1. **ç”Ÿäº§éƒ¨ç½²**: `pnpm build`ï¼ˆæ„å»ºä¼˜åŒ–ç‰ˆæœ¬ï¼‰
2. **å‘å¸ƒ npm åŒ…**: å¦‚æœè¦å‘å¸ƒåº“åˆ° npm
3. **CI/CD æµç¨‹**: è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²

### å¼€å‘è¿‡ç¨‹ä¸­æ°¸è¿œä¸éœ€è¦ï¼

- âŒ ~~`pnpm --filter @hl8/database build`~~
- âŒ ~~æ‰‹åŠ¨é‡å¯åº”ç”¨~~
- âœ… åªéœ€ä¿®æ”¹ä»£ç å¹¶ä¿å­˜ï¼

---

## ğŸŠ å¼€å‘ä½“éªŒå·²ä¼˜åŒ–ï¼

ç°åœ¨æ‚¨å¯ä»¥ï¼š

- âœ… ç›´æ¥ä¿®æ”¹ä»»ä½• libs ä»£ç ï¼Œè‡ªåŠ¨ç”Ÿæ•ˆ
- âœ… ä¸“æ³¨äºåŠŸèƒ½å¼€å‘ï¼Œä¸ç”¨æ‹…å¿ƒæ„å»º
- âœ… æé€Ÿåé¦ˆï¼Œ2-3ç§’çœ‹åˆ°ç»“æœ
- âœ… åƒå¼€å‘å•ä½“åº”ç”¨ä¸€æ ·æµç•…

**äº«å—ä¸æ»‘çš„å¼€å‘ä½“éªŒå§ï¼** ğŸš€âš¡

---

æœ€åæ›´æ–°: 2025-10-13

