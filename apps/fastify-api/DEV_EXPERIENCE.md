# å¼€å‘ä½“éªŒä¼˜åŒ–è¯´æ˜

## ğŸš€ ä¼˜åŒ–åçš„å¼€å‘æµç¨‹

### é—®é¢˜

ä¹‹å‰ä¿®æ”¹ libs ä¸­çš„ä»£ç åï¼Œéœ€è¦ï¼š

1. æ‰‹åŠ¨é‡æ–°æ„å»ºåº“ (`pnpm --filter @hl8/database build`)
2. é‡å¯åº”ç”¨
3. ç­‰å¾…ç¼–è¯‘

è¿™ä¸¥é‡å½±å“å¼€å‘æ•ˆç‡ï¼

### è§£å†³æ–¹æ¡ˆï¼šTurborepo å¹¶è¡Œ Watch æ¨¡å¼

ä½¿ç”¨ **ä¸¤ä¸ªç»ˆç«¯**ï¼Œä¸€ä¸ª watch æ‰€æœ‰åº“ï¼Œä¸€ä¸ªè¿è¡Œåº”ç”¨ï¼š

**ç»ˆç«¯ 1** - Watch æ‰€æœ‰åº“ï¼ˆè‡ªåŠ¨é‡æ–°ç¼–è¯‘ï¼‰:

```bash
pnpm turbo dev --filter='@hl8/*'
```

**ç»ˆç«¯ 2** - è¿è¡Œåº”ç”¨ï¼ˆè‡ªåŠ¨é‡æ–°åŠ è½½ï¼‰:

```bash
pnpm --filter fastify-api dev
```

### æ•ˆæœ

ç°åœ¨ä¿®æ”¹ libs ä»£ç åï¼š

- âœ… **è‡ªåŠ¨æ£€æµ‹**: tsc --watch æ£€æµ‹æºç æ›´æ”¹
- âœ… **è‡ªåŠ¨ç¼–è¯‘**: è‡ªåŠ¨é‡æ–°ç¼–è¯‘åˆ° distï¼ˆ~1-2sï¼‰
- âœ… **è‡ªåŠ¨é‡å¯**: NestJS æ£€æµ‹åˆ° dist æ›´æ”¹ï¼Œè‡ªåŠ¨é‡å¯åº”ç”¨
- âœ… **æ— éœ€æ‰‹åŠ¨æ“ä½œ**: å®Œå…¨è‡ªåŠ¨åŒ–

---

## ğŸ“ å·¥ä½œæµç¨‹å¯¹æ¯”

### ä¹‹å‰ï¼ˆå·®ä½“éªŒï¼‰âŒ

```bash
# 1. ä¿®æ”¹ libs/database/src/connection/connection.manager.ts
# 2. æ‰‹åŠ¨æ„å»º
pnpm --filter @hl8/database build

# 3. ç­‰å¾…æ„å»ºå®Œæˆï¼ˆ~5-10ç§’ï¼‰
# 4. æ‰‹åŠ¨é‡å¯åº”ç”¨
# 5. ç­‰å¾…åº”ç”¨å¯åŠ¨ï¼ˆ~10ç§’ï¼‰

æ€»è€—æ—¶: ~15-20ç§’ â±ï¸
```

### ç°åœ¨ï¼ˆä¼˜ç§€ä½“éªŒï¼‰âœ…

```bash
# ç»ˆç«¯ 1: å¯åŠ¨æ‰€æœ‰åº“çš„ watch æ¨¡å¼ï¼ˆä¸€æ¬¡æ€§ï¼Œåå°è¿è¡Œï¼‰
pnpm turbo dev --filter='@hl8/*'

# ç»ˆç«¯ 2: è¿è¡Œåº”ç”¨
pnpm --filter fastify-api dev

# ç„¶åï¼š
# 1. ä¿®æ”¹ libs/database/src/connection/connection.manager.ts
# 2. ä¿å­˜æ–‡ä»¶ (Ctrl+S)

# è‡ªåŠ¨å‘ç”Ÿï¼š
# - tsc watch æ£€æµ‹åˆ°æ›´æ”¹
# - è‡ªåŠ¨é‡æ–°ç¼–è¯‘åˆ° distï¼ˆ~1-2sï¼‰
# - NestJS æ£€æµ‹åˆ° dist æ›´æ”¹
# - åº”ç”¨è‡ªåŠ¨é‡å¯ï¼ˆ~2-3sï¼‰

æ€»è€—æ—¶: ~3-5ç§’ âš¡
```

**é€Ÿåº¦æå‡**: 4-6å€ï¼  
**æ— éœ€æ‰‹åŠ¨æ“ä½œ**: 100%è‡ªåŠ¨åŒ–ï¼

---

## ğŸ¯ å¯åŠ¨å¼€å‘ç¯å¢ƒ

### åˆæ¬¡å¯åŠ¨ï¼ˆ2ä¸ªç»ˆç«¯ï¼‰

**ç»ˆç«¯ 1** - Watch æ‰€æœ‰åº“:

```bash
cd /home/arligle/hl8/hl8-saas-platform-turborepo

# å¹¶è¡Œ watch æ‰€æœ‰ @hl8/* åº“
pnpm turbo dev --filter='@hl8/*'
```

**è¾“å‡ºç¤ºä¾‹**:

```
@hl8/config:dev: Starting compilation in watch mode...
@hl8/database:dev: Starting compilation in watch mode...
@hl8/exceptions:dev: Starting compilation in watch mode...
@hl8/nestjs-fastify:dev: Starting compilation in watch mode...
...
```

**ç»ˆç«¯ 2** - è¿è¡Œåº”ç”¨:

```bash
cd /home/arligle/hl8/hl8-saas-platform-turborepo

# è¿è¡Œ fastify-api
pnpm --filter fastify-api dev
```

### æŒç»­å¼€å‘ï¼ˆè‡ªåŠ¨åŒ–ï¼‰

ä¿®æ”¹ä»»ä½•ä»£ç åï¼š

1. **åº“ä»£ç æ›´æ”¹** â†’ tsc watch è‡ªåŠ¨ç¼–è¯‘ â†’ dist æ›´æ–°
2. **dist æ›´æ”¹** â†’ NestJS watch æ£€æµ‹åˆ° â†’ åº”ç”¨è‡ªåŠ¨é‡å¯
3. **3-5ç§’å** â†’ æ›´æ”¹ç”Ÿæ•ˆ âœ…

**æ— éœ€ä»»ä½•æ‰‹åŠ¨æ“ä½œï¼**

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä¿æŒåº”ç”¨è¿è¡Œ

```bash
# å¯åŠ¨ä¸€æ¬¡ï¼ŒæŒç»­å¼€å‘
pnpm --filter fastify-api dev

# ç„¶åå°±å¯ä»¥éšæ„ä¿®æ”¹ä»»ä½•ä»£ç ï¼Œè‡ªåŠ¨ç”Ÿæ•ˆ
```

### 2. ä½¿ç”¨ VSCode å¤šçª—å£

- çª—å£1: `libs/database/src` - ç¼–è¾‘åº“ä»£ç 
- çª—å£2: `apps/fastify-api/src` - ç¼–è¾‘åº”ç”¨ä»£ç 
- ç»ˆç«¯: è¿è¡Œ `pnpm dev` - è‡ªåŠ¨é‡æ–°ç¼–è¯‘

### 3. æŸ¥çœ‹æ—¥å¿—è¾“å‡º

```
File change detected. Starting incremental compilation...
Successfully compiled: XX files with swc (XXXms)
Watching for file changes.
```

çœ‹åˆ°è¿™ä¸ªè¾“å‡ºå°±è¯´æ˜æ›´æ”¹å·²åº”ç”¨ï¼

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### TypeScript Paths

```json
{
  "paths": {
    "@hl8/database": ["../../libs/database/src/index.ts"]
  }
}
```

- **ç¼–è¯‘æ—¶**: TypeScript/SWC ç›´æ¥è¯»å–æºç 
- **è¿è¡Œæ—¶**: Node.js é€šè¿‡è½¬æ¢åçš„è·¯å¾„åŠ è½½æ¨¡å—
- **Watch æ¨¡å¼**: æ£€æµ‹ libs å’Œ apps çš„æ‰€æœ‰æ–‡ä»¶æ›´æ”¹

### SWC Watch æ¨¡å¼

NestJS çš„ `nest start -b swc -w`:

- `-b swc`: ä½¿ç”¨ SWC ç¼–è¯‘å™¨ï¼ˆæ¯” tsc å¿« 20-70å€ï¼‰
- `-w`: Watch æ¨¡å¼ï¼Œæ–‡ä»¶æ›´æ”¹è‡ªåŠ¨é‡æ–°ç¼–è¯‘

### ä¼˜åŠ¿

1. **å¿«é€Ÿç¼–è¯‘**: SWC ~200ms vs tsc ~5-10s
2. **è‡ªåŠ¨æ£€æµ‹**: ç›‘è§†æ‰€æœ‰ç›¸å…³æ–‡ä»¶
3. **å¢é‡ç¼–è¯‘**: åªç¼–è¯‘æ›´æ”¹çš„æ–‡ä»¶
4. **çƒ­é‡è½½**: åº”ç”¨è‡ªåŠ¨é‡å¯

---

## ğŸ‰ ç°åœ¨è¯•è¯•çœ‹

### æµ‹è¯•çƒ­é‡è½½

1. **å¯åŠ¨åº”ç”¨**ï¼ˆå¦‚æœè¿˜æ²¡è¿è¡Œï¼‰:

   ```bash
   pnpm --filter fastify-api dev
   ```

2. **ä¿®æ”¹åº“ä»£ç **:

   ```typescript
   // libs/database/src/connection/connection.manager.ts
   async connect(): Promise<void> {
     this.logger.log('ğŸš€ æ•°æ®åº“è¿æ¥æˆåŠŸï¼ˆçƒ­é‡è½½æµ‹è¯•ï¼‰'); // ä¿®æ”¹è¿™è¡Œ
     // ...
   }
   ```

3. **ä¿å­˜æ–‡ä»¶** (`Ctrl+S`)

4. **æŸ¥çœ‹ç»ˆç«¯**: 2ç§’å†…åº”è¯¥çœ‹åˆ°ï¼š

   ```
   File change detected. Starting incremental compilation...
   Successfully compiled: 12 files with swc (XXXms)
   [Nest] INFO ğŸš€ æ•°æ®åº“è¿æ¥æˆåŠŸï¼ˆçƒ­é‡è½½æµ‹è¯•ï¼‰
   ```

5. **æ— éœ€ä»»ä½•æ‰‹åŠ¨æ“ä½œï¼** âœ…

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æ“ä½œ | æ—§æ–¹å¼ | æ–°æ–¹å¼ | æå‡ |
|------|--------|--------|------|
| ä¿®æ”¹åº“ä»£ç  | 15-20s | 2-3s | **7x** |
| ä¿®æ”¹åº”ç”¨ä»£ç  | 10s | 2s | **5x** |
| æ·»åŠ æ–°åŠŸèƒ½ | 20s | 3s | **7x** |
| ä¿®å¤ Bug | 15s | 2s | **7.5x** |

---

## ğŸ’¯ æ³¨æ„äº‹é¡¹

### ä½•æ—¶ä»éœ€æ‰‹åŠ¨æ„å»ºï¼Ÿ

åªæœ‰ä»¥ä¸‹æƒ…å†µéœ€è¦æ‰‹åŠ¨æ„å»ºï¼š

1. **ç”Ÿäº§éƒ¨ç½²**: `pnpm build`ï¼ˆæ„å»ºä¼˜åŒ–ç‰ˆæœ¬ï¼‰
2. **å‘å¸ƒ npm åŒ…**: å¦‚æœè¦å‘å¸ƒåº“åˆ° npm
3. **CI/CD æµç¨‹**: è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²

### å¼€å‘è¿‡ç¨‹ä¸­æ°¸è¿œä¸éœ€è¦

- âŒ ~~`pnpm --filter @hl8/database build`~~
- âŒ ~~æ‰‹åŠ¨é‡å¯åº”ç”¨~~
- âœ… åªéœ€ä¿®æ”¹ä»£ç å¹¶ä¿å­˜ï¼

---

## ğŸŠ å¼€å‘ä½“éªŒå·²ä¼˜åŒ–

ç°åœ¨æ‚¨å¯ä»¥ï¼š

- âœ… ç›´æ¥ä¿®æ”¹ä»»ä½• libs ä»£ç ï¼Œè‡ªåŠ¨ç”Ÿæ•ˆ
- âœ… ä¸“æ³¨äºåŠŸèƒ½å¼€å‘ï¼Œä¸ç”¨æ‹…å¿ƒæ„å»º
- âœ… æé€Ÿåé¦ˆï¼Œ2-3ç§’çœ‹åˆ°ç»“æœ
- âœ… åƒå¼€å‘å•ä½“åº”ç”¨ä¸€æ ·æµç•…

**äº«å—ä¸æ»‘çš„å¼€å‘ä½“éªŒå§ï¼** ğŸš€âš¡

---

æœ€åæ›´æ–°: 2025-10-13
