# ğŸš€ Turborepo å¿«é€Ÿå‚è€ƒ

## ğŸ“Š ä¾èµ–å…³ç³»ä¸€å›¾çœ‹æ‡‚

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  libs/nestjs-infra  â”‚
                    â”‚   (åŸºç¡€è®¾æ–½å±‚)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   å¿…é¡»å…ˆæ„å»º(^build)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
        â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”»â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
        â”ƒ                                               â”ƒ
  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                                 â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
  â”‚ apps/      â”‚                                 â”‚ apps/api   â”‚
  â”‚ fastify-apiâ”‚                                 â”‚            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš¡ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

| åœºæ™¯ | å‘½ä»¤ | è¯´æ˜ |
|------|------|------|
| **å¼€å‘** | `cd apps/fastify-api && pnpm dev` | ç›´æ¥å¯åŠ¨ï¼Œæ— éœ€æ„å»º libs |
| **æ„å»ºå…¨éƒ¨** | `pnpm turbo build` | æŒ‰ä¾èµ–é¡ºåºæ„å»ºæ‰€æœ‰é¡¹ç›® |
| **æ„å»ºå•ä¸ª** | `pnpm turbo build --filter=fastify-api...` | æ„å»ºæŒ‡å®šåº”ç”¨åŠå…¶ä¾èµ– |
| **ç±»å‹æ£€æŸ¥** | `pnpm turbo type-check` | æ£€æŸ¥æ‰€æœ‰é¡¹ç›®ç±»å‹ |
| **ä»£ç æ£€æŸ¥** | `pnpm turbo lint` | è¿è¡Œ ESLint |
| **è¿è¡Œæµ‹è¯•** | `pnpm turbo test` | è¿è¡Œå•å…ƒæµ‹è¯• |
| **æ¸…ç†** | `pnpm turbo clean` | æ¸…ç†æ‰€æœ‰æ„å»ºäº§ç‰© |

---

## ğŸ¯ å·¥ä½œæµç¨‹

### å¼€å‘æµç¨‹ï¼ˆæœ€å¸¸ç”¨ï¼‰â­

```bash
# 1ï¸âƒ£ å®‰è£…ä¾èµ–ï¼ˆé¦–æ¬¡ï¼‰
pnpm install

# 2ï¸âƒ£ å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆæ— éœ€æ„å»ºï¼ï¼‰
cd apps/fastify-api
pnpm dev

# 3ï¸âƒ£ å¼€å‘
# âœ… ä¿®æ”¹ apps/fastify-api ä»£ç  â†’ è‡ªåŠ¨é‡è½½
# âœ… ä¿®æ”¹ libs/nestjs-infra ä»£ç  â†’ è‡ªåŠ¨é‡è½½
# âœ… å®Œæ•´çš„ç±»å‹æç¤ºå’Œè°ƒè¯•æ”¯æŒ
```

### æäº¤ä»£ç å‰

```bash
# è¿è¡Œæ‰€æœ‰æ£€æŸ¥
pnpm turbo type-check lint test

# æˆ–è€…å•ç‹¬è¿è¡Œ
pnpm turbo type-check  # ç±»å‹æ£€æŸ¥
pnpm turbo lint        # ä»£ç è§„èŒƒ
pnpm turbo test        # å•å…ƒæµ‹è¯•
```

### ç”Ÿäº§éƒ¨ç½²

```bash
# 1ï¸âƒ£ å®‰è£…ä¾èµ–
pnpm install --frozen-lockfile

# 2ï¸âƒ£ æ„å»ºï¼ˆè‡ªåŠ¨æŒ‰ä¾èµ–é¡ºåºï¼‰
pnpm turbo build

# 3ï¸âƒ£ å¯åŠ¨ç”Ÿäº§æœåŠ¡
cd apps/fastify-api
pnpm start
```

---

## ğŸ” ä¾èµ–ç¬¦å·è¯´æ˜

| ç¬¦å· | å«ä¹‰ | ç¤ºä¾‹ |
|------|------|------|
| `^build` | å…ˆæ„å»º**æ‰€æœ‰ä¾èµ–é¡¹** | libs â†’ apps |
| `build` | å…ˆæ„å»º**å½“å‰é¡¹ç›®** | è‡ªèº«çš„å…¶ä»–ä»»åŠ¡ |
| `[]` | **æ— ä¾èµ–** | dev æ¨¡å¼ï¼ˆç›´æ¥å¯åŠ¨ï¼‰|

### å®é™…æ¡ˆä¾‹

```json
// apps/fastify-api æ‰§è¡Œ build ä»»åŠ¡
{
  "build": {
    "dependsOn": ["^build"]  // â† å…ˆæ„å»º libs/nestjs-infra
  }
}

// æ‰§è¡Œé¡ºåºï¼š
// 1. libs/nestjs-infra build  âœ…
// 2. apps/fastify-api build   âœ…
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### âœ… DOï¼ˆæ¨èï¼‰

```bash
# âœ… å¼€å‘æ—¶ç›´æ¥å¯åŠ¨ï¼ˆæ— éœ€æ„å»ºï¼‰
pnpm dev

# âœ… ä½¿ç”¨ Turborepo ç®¡ç†æ„å»ºé¡ºåº
pnpm turbo build

# âœ… ä½¿ç”¨è¿‡æ»¤å™¨æ„å»ºç‰¹å®šé¡¹ç›®
pnpm turbo build --filter=fastify-api...

# âœ… æäº¤å‰è¿è¡Œå®Œæ•´æ£€æŸ¥
pnpm turbo type-check lint test
```

### âŒ DON'Tï¼ˆé¿å…ï¼‰

```bash
# âŒ ä¸è¦æ‰‹åŠ¨æ„å»ºä¾èµ–é¡¹
cd libs/nestjs-infra && pnpm build
cd apps/fastify-api && pnpm build

# âŒ ä¸è¦åœ¨å¼€å‘æ¨¡å¼æ„å»º
cd libs/nestjs-infra && pnpm build  # ä¸éœ€è¦ï¼
cd apps/fastify-api && pnpm dev

# âŒ ä¸è¦è·³è¿‡ç±»å‹æ£€æŸ¥
pnpm build --no-type-check
```

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| æ“ä½œ | ä¼ ç»Ÿæ–¹å¼ | Turborepo + è·¯å¾„åˆ«å | æå‡ |
|------|---------|---------------------|------|
| **dev å¯åŠ¨** | ~30s | ~3s | **10x** âš¡ |
| **ä¿®æ”¹ libs** | é‡æ–°æ„å»º ~20s | çƒ­é‡è½½ <1s | **20x** ğŸ”¥ |
| **CI æ„å»º** | é¡ºåºæ„å»º ~5min | å¹¶è¡Œ + ç¼“å­˜ ~2min | **2.5x** ğŸš€ |

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: å¼€å‘æ—¶éœ€è¦æ„å»º libs å—ï¼Ÿ

**A**: âŒ **ä¸éœ€è¦ï¼**ä½¿ç”¨è·¯å¾„åˆ«åç›´æ¥è®¿é—®æºç ã€‚

### Q2: ç±»å‹æ£€æŸ¥æŠ¥é”™æ‰¾ä¸åˆ°æ¨¡å—ï¼Ÿ

**A**: è¿è¡Œ `pnpm turbo build` ç”Ÿæˆç±»å‹å£°æ˜æ–‡ä»¶ã€‚

### Q3: æµ‹è¯•å¤±è´¥æ‰¾ä¸åˆ°æ¨¡å—ï¼Ÿ

**A**: ç¡®ä¿è¿è¡Œäº† `pnpm turbo build`ï¼Œæµ‹è¯•ä¾èµ–ç¼–è¯‘äº§ç‰©ã€‚

### Q4: å¦‚ä½•åªæ„å»ºä¸€ä¸ªåº”ç”¨ï¼Ÿ

**A**: ä½¿ç”¨è¿‡æ»¤å™¨ï¼š`pnpm turbo build --filter=fastify-api...`

### Q5: å¦‚ä½•æ¸…ç†é‡å»ºï¼Ÿ

**A**: `pnpm turbo clean && pnpm turbo build`

---

## ğŸ“ è¿›é˜¶æŠ€å·§

### å¹¶è¡Œå¼€å‘å¤šä¸ªåº”ç”¨

```bash
# Terminal 1
cd apps/fastify-api && pnpm dev

# Terminal 2  
cd apps/web && pnpm dev

# libs çš„ä¿®æ”¹ä¼šåŒæ—¶çƒ­é‡è½½åˆ°ä¸¤ä¸ªåº”ç”¨ï¼
```

### å¢é‡æ„å»ºï¼ˆåªæ„å»ºå˜æ›´éƒ¨åˆ†ï¼‰

```bash
# åªæ„å»ºè‡ªä¸Šæ¬¡ git commit ä»¥æ¥å˜æ›´çš„é¡¹ç›®
pnpm turbo build --filter=[HEAD^1]
```

### è¿œç¨‹ç¼“å­˜ï¼ˆå›¢é˜Ÿå…±äº«ï¼‰

```bash
# é…ç½®è¿œç¨‹ç¼“å­˜
pnpm turbo login
pnpm turbo link

# å…¶ä»–å›¢é˜Ÿæˆå‘˜å¯ä»¥å¤ç”¨æ„å»ºç¼“å­˜ï¼
pnpm turbo build  # å¯èƒ½ç›´æ¥å‘½ä¸­è¿œç¨‹ç¼“å­˜
```

### æŸ¥çœ‹ä»»åŠ¡ä¾èµ–å›¾

```bash
# ç”Ÿæˆä¾èµ–å›¾ï¼ˆéœ€è¦å®‰è£… graphvizï¼‰
pnpm turbo run build --graph
```

---

## ğŸ“š å»¶ä¼¸é˜…è¯»

- [å®Œæ•´æ„å»ºé¡ºåºè¯´æ˜](./docs/turborepo-build-order.md)
- [Turborepo å®˜æ–¹æ–‡æ¡£](https://turbo.build/repo/docs)
- [Monorepo æœ€ä½³å®è·µ](./docs/monorepo-best-practices.md)

---

## ğŸ¯ è®°ä½è¿™äº›æ ¸å¿ƒç‚¹

1. **å¼€å‘æ¨¡å¼**ï¼šç›´æ¥ `pnpm dev`ï¼Œæ— éœ€æ„å»º âš¡
2. **ç”Ÿäº§æ„å»º**ï¼š`pnpm turbo build` è‡ªåŠ¨ç®¡ç†ä¾èµ–é¡ºåº ğŸš€
3. **æäº¤å‰**ï¼š`pnpm turbo type-check lint test` âœ…
4. **é—®é¢˜æ’æŸ¥**ï¼šæ¸…ç†é‡å»º `pnpm turbo clean && pnpm install` ğŸ”§

---

**äº«å— 10x çš„å¼€å‘ä½“éªŒå§ï¼** ğŸ‰
