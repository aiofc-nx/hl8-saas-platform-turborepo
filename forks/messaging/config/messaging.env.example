# HL8 SAAS平台消息队列环境变量配置示例
# 复制此文件为 .env 并根据实际情况修改配置值

# =============================================================================
# 基础配置
# =============================================================================

# 消息队列适配器类型 (rabbitmq, redis, kafka, memory)
MESSAGING_ADAPTER=rabbitmq

# 键前缀，用于租户隔离
MESSAGING_KEY_PREFIX=hl8:messaging:

# 是否启用租户隔离
MESSAGING_ENABLE_TENANT_ISOLATION=true

# 异常文档URL
MESSAGING_DOCUMENTATION_URL=https://docs.hl8.com/messaging/errors

# =============================================================================
# RabbitMQ 配置
# =============================================================================

# RabbitMQ连接URL
MESSAGING_RABBITMQ__URL=amqp://localhost:5672

# 默认交换机名称
MESSAGING_RABBITMQ__EXCHANGE=hl8_saas

# 队列名称前缀
MESSAGING_RABBITMQ__QUEUE_PREFIX=hl8_

# 心跳间隔（秒）
MESSAGING_RABBITMQ__HEARTBEAT=30

# 连接超时时间（毫秒）
MESSAGING_RABBITMQ__OPTIONS__CONNECTION_TIMEOUT=30000

# 最大帧大小
MESSAGING_RABBITMQ__OPTIONS__FRAME_MAX=4096

# 最大通道数（0表示无限制）
MESSAGING_RABBITMQ__OPTIONS__CHANNEL_MAX=0

# 区域设置
MESSAGING_RABBITMQ__OPTIONS__LOCALE=en_US

# =============================================================================
# Redis 配置
# =============================================================================

# Redis主机
MESSAGING_REDIS__HOST=localhost

# Redis端口
MESSAGING_REDIS__PORT=6379

# Redis数据库编号
MESSAGING_REDIS__DB=1

# Redis密码（可选）
MESSAGING_REDIS__PASSWORD=

# 流名称前缀
MESSAGING_REDIS__STREAM_PREFIX=hl8:messaging:stream:

# 故障转移重试延迟（毫秒）
MESSAGING_REDIS__OPTIONS__RETRY_DELAY_ON_FAILOVER=100

# 每个请求的最大重试次数
MESSAGING_REDIS__OPTIONS__MAX_RETRIES_PER_REQUEST=3

# 延迟连接
MESSAGING_REDIS__OPTIONS__LAZY_CONNECT=true

# 保持连接时间（毫秒）
MESSAGING_REDIS__OPTIONS__KEEP_ALIVE=30000

# =============================================================================
# Kafka 配置
# =============================================================================

# Kafka客户端ID
MESSAGING_KAFKA__CLIENT_ID=hl8-messaging-client

# Kafka代理列表（用逗号分隔）
MESSAGING_KAFKA__BROKERS=localhost:9092,localhost:9093

# 主题名称前缀
MESSAGING_KAFKA__TOPIC_PREFIX=hl8:messaging:

# 请求超时时间（毫秒）
MESSAGING_KAFKA__OPTIONS__REQUEST_TIMEOUT=30000

# 初始重试时间（毫秒）
MESSAGING_KAFKA__OPTIONS__RETRY__INITIAL_RETRY_TIME=100

# 最大重试时间（毫秒）
MESSAGING_KAFKA__OPTIONS__RETRY__MAX_RETRY_TIME=30000

# 重试次数
MESSAGING_KAFKA__OPTIONS__RETRY__RETRIES=5

# 连接超时时间（毫秒）
MESSAGING_KAFKA__OPTIONS__CONNECTION_TIMEOUT=3000

# 认证超时时间（毫秒）
MESSAGING_KAFKA__OPTIONS__AUTHENTICATION_TIMEOUT=1000

# 重新认证阈值（毫秒）
MESSAGING_KAFKA__OPTIONS__REAUTHENTICATION_THRESHOLD=10000

# =============================================================================
# 缓存配置
# =============================================================================

# 启用消息去重缓存
MESSAGING_CACHE__ENABLE_MESSAGE_DEDUPLICATION=true

# 启用消费者状态缓存
MESSAGING_CACHE__ENABLE_CONSUMER_STATE_CACHE=true

# 启用统计信息缓存
MESSAGING_CACHE__ENABLE_STATS_CACHE=true

# 启用死信队列缓存
MESSAGING_CACHE__ENABLE_DEAD_LETTER_CACHE=true

# 启用租户配置缓存
MESSAGING_CACHE__ENABLE_TENANT_CONFIG_CACHE=true

# 缓存键前缀
MESSAGING_CACHE__KEY_PREFIX=hl8:messaging:cache:

# 消息去重缓存TTL（秒）
MESSAGING_CACHE__CACHE_TTL__MESSAGE_DEDUP=300

# 消费者状态缓存TTL（秒）
MESSAGING_CACHE__CACHE_TTL__CONSUMER_STATE=3600

# 统计信息缓存TTL（秒）
MESSAGING_CACHE__CACHE_TTL__STATS=60

# 死信队列缓存TTL（秒）
MESSAGING_CACHE__CACHE_TTL__DEAD_LETTER=86400

# 租户配置缓存TTL（秒）
MESSAGING_CACHE__CACHE_TTL__TENANT_CONFIG=3600

# 缓存Redis主机
MESSAGING_CACHE__REDIS__HOST=localhost

# 缓存Redis端口
MESSAGING_CACHE__REDIS__PORT=6379

# 缓存Redis数据库编号
MESSAGING_CACHE__REDIS__DB=2

# 缓存Redis密码（可选）
MESSAGING_CACHE__REDIS__PASSWORD=

# 缓存Redis故障转移重试延迟（毫秒）
MESSAGING_CACHE__REDIS__OPTIONS__RETRY_DELAY_ON_FAILOVER=100

# 缓存Redis每个请求的最大重试次数
MESSAGING_CACHE__REDIS__OPTIONS__MAX_RETRIES_PER_REQUEST=3

# 缓存Redis延迟连接
MESSAGING_CACHE__REDIS__OPTIONS__LAZY_CONNECT=true

# =============================================================================
# 多租户配置
# =============================================================================

# 启用自动注入
MESSAGING_MULTI_TENANCY__CONTEXT__ENABLE_AUTO_INJECTION=true

# 上下文超时时间（毫秒）
MESSAGING_MULTI_TENANCY__CONTEXT__CONTEXT_TIMEOUT=30000

# 启用审计日志
MESSAGING_MULTI_TENANCY__CONTEXT__ENABLE_AUDIT_LOG=true

# 上下文存储方式 (memory, redis)
MESSAGING_MULTI_TENANCY__CONTEXT__CONTEXT_STORAGE=memory

# 允许跨租户访问
MESSAGING_MULTI_TENANCY__CONTEXT__ALLOW_CROSS_TENANT_ACCESS=false

# 隔离策略 (key-prefix, namespace, database)
MESSAGING_MULTI_TENANCY__ISOLATION__STRATEGY=key-prefix

# 隔离键前缀
MESSAGING_MULTI_TENANCY__ISOLATION__KEY_PREFIX=hl8:messaging:

# 命名空间
MESSAGING_MULTI_TENANCY__ISOLATION__NAMESPACE=messaging-namespace

# 启用隔离
MESSAGING_MULTI_TENANCY__ISOLATION__ENABLE_ISOLATION=true

# 隔离级别 (strict, moderate, loose)
MESSAGING_MULTI_TENANCY__ISOLATION__LEVEL=strict

# 启用租户中间件
MESSAGING_MULTI_TENANCY__MIDDLEWARE__ENABLE_TENANT_MIDDLEWARE=true

# 租户ID请求头
MESSAGING_MULTI_TENANCY__MIDDLEWARE__TENANT_HEADER=X-Tenant-ID

# 租户ID查询参数
MESSAGING_MULTI_TENANCY__MIDDLEWARE__TENANT_QUERY_PARAM=tenant

# 支持子域名租户识别
MESSAGING_MULTI_TENANCY__MIDDLEWARE__TENANT_SUBDOMAIN=true

# 验证超时时间（毫秒）
MESSAGING_MULTI_TENANCY__MIDDLEWARE__VALIDATION_TIMEOUT=5000

# 严格验证模式
MESSAGING_MULTI_TENANCY__MIDDLEWARE__STRICT_VALIDATION=true

# 启用安全检查
MESSAGING_MULTI_TENANCY__SECURITY__ENABLE_SECURITY_CHECK=true

# 最大失败尝试次数
MESSAGING_MULTI_TENANCY__SECURITY__MAX_FAILED_ATTEMPTS=5

# 锁定持续时间（毫秒）
MESSAGING_MULTI_TENANCY__SECURITY__LOCKOUT_DURATION=300000

# 启用安全审计日志
MESSAGING_MULTI_TENANCY__SECURITY__ENABLE_AUDIT_LOG=true

# 启用IP白名单
MESSAGING_MULTI_TENANCY__SECURITY__ENABLE_IP_WHITELIST=false

# =============================================================================
# 监控配置
# =============================================================================

# 启用统计功能
MESSAGING_MONITORING__ENABLE_STATS=true

# 启用健康检查
MESSAGING_MONITORING__ENABLE_HEALTH_CHECK=true

# 统计收集间隔（毫秒）
MESSAGING_MONITORING__STATS_INTERVAL=60000

# =============================================================================
# 重试配置
# =============================================================================

# 最大重试次数
MESSAGING_RETRY__MAX_RETRIES=3

# 重试延迟（毫秒）
MESSAGING_RETRY__RETRY_DELAY=1000

# 退避策略 (linear, exponential, fixed)
MESSAGING_RETRY__BACKOFF=exponential

# 启用死信队列
MESSAGING_RETRY__ENABLE_DEAD_LETTER_QUEUE=true

# =============================================================================
# 租户配置（向后兼容）
# =============================================================================

# 启用租户隔离
MESSAGING_TENANT__ENABLE_ISOLATION=true

# 租户前缀
MESSAGING_TENANT__TENANT_PREFIX=tenant:

# 自动创建租户队列
MESSAGING_TENANT__AUTO_CREATE_TENANT_QUEUES=true

# 租户队列数量限制
MESSAGING_TENANT__TENANT_QUEUE_LIMIT=100

# =============================================================================
# 生产环境示例配置
# =============================================================================

# 生产环境建议使用以下配置：
# MESSAGING_ADAPTER=rabbitmq
# MESSAGING_ENABLE_TENANT_ISOLATION=true
# MESSAGING_RABBITMQ__URL=amqp://user:password@rabbitmq-cluster:5672
# MESSAGING_CACHE__REDIS__HOST=redis-cluster
# MESSAGING_CACHE__REDIS__PASSWORD=your-redis-password
# MESSAGING_MULTI_TENANCY__CONTEXT__CONTEXT_STORAGE=redis
# MESSAGING_MULTI_TENANCY__SECURITY__ENABLE_SECURITY_CHECK=true
# MESSAGING_MONITORING__ENABLE_STATS=true
